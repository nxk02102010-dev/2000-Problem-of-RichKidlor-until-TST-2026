https://oj.clue.edu.vn/problem/prevoi26_message



#include<bits/stdc++.h>
using namespace std;
const int MAX = 300300;
#define int long long
struct E{
    int v,w,f;
};
struct SS{
    int w,f,u;
    bool operator >(const SS &other) const{
        return w > other.w;
    }
};
int n,m,St,T;
vector<E> g[MAX];
void buildTree(){
    cin >> n >> m >> St >> T;
    int a,b,c,d;
    for(int i = 0;i < m;i++){
        cin >> a >> b >> c >> d;
        g[a].push_back({b,c,d});
        g[b].push_back({a,c,d});
    }
    return;
}
void Dijsktra(){
    unordered_map<int,int> dis[n + 1];
    priority_queue<SS,vector<SS>,greater<SS>> q;
    dis[St][-1] = 0;
    q.push({0,-1,St});
    #define F first
    #define S second
    while(q.size()){
        auto top = q.top();q.pop();
        int f1 = top.f;
        int w1 = top.w;
        int u = top.u;
        if(dis[u][f1] != w1) continue;
        if(u == T){
            cout << w1 << '\n';
            return;
        }
        for(auto to : g[u]){
            int v = to.v;
            int w2 = to.w;
            int f2 = to.f;
            if(!dis[v].count(f2) || (dis[v][f2] > (f1 == -1 ? 0 : (abs(f1 - f2))) + w1 + w2)){
                dis[v][f2] = (f1 == -1 ? 0 : (abs(f1 - f2))) + w1 + w2;
                q.push({dis[v][f2],f2,v});
            }
        }
    }
    //cout <<-1;
}
void solve(void){
    buildTree();
    Dijsktra();
    return;
}
signed main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    cout.tie(0);
    solve();
}
